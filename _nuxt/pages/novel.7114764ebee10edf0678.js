webpackJsonp([4],{"5zde":function(t,e,o){o("zQR9"),o("qyJz"),t.exports=o("FeBl").Array.from},Gu7T:function(t,e,o){"use strict";e.__esModule=!0;var n=function(t){return t&&t.__esModule?t:{default:t}}(o("c/Tr"));e.default=function(t){if(Array.isArray(t)){for(var e=0,o=Array(t.length);e<t.length;e++)o[e]=t[e];return o}return(0,n.default)(t)}},PMX5:function(t,e,o){"use strict";var n=o("Gu7T"),a=o.n(n),r=o("BO1k"),s=o.n(r),i=o("YbGK"),c=o.n(i);e.a={name:"novel",components:{},data:function(){return{keyword:"网游之真幻无双",loading:!1,selectType:"customer",customerUrl:"https://www.biqugexsw.com/86_86838/",customerStatus:!1,progressStatus:"active",percent:0,newNovelDownload:!1,disabledDownload:!1,webSocketCount:0,webSocketCountData:[],novelTable:[],novelData:[],pageData:{page:1,totals:1,isVip:"",hasContent:""},isDev:c.a.dev}},computed:{isDoneWebSocketCustomer:function(){var t=this.webSocketCountData.length,e=this.webSocketCount;return!(!this.webSocketCount||t+1!==e&&t!==e)&&(this.disabledDownload=!1,!0)},novelCustomerContent:function(){var t=this.novelData.sort(function(t,e){return t.index-e.index}),e="",o=!0,n=!1,a=void 0;try{for(var r,i=s()(t);!(o=(r=i.next()).done);o=!0){var c=r.value;e=e+c.title+this.formatNovelData(c.content)+"\n\n"}}catch(t){n=!0,a=t}finally{try{!o&&i.return&&i.return()}finally{if(n)throw a}}return e}},mounted:function(){this.webSocketReceive()},updated:function(){},methods:{webSocketReceive:function(){var t=this;this.$socket.on("isConnectSocketStatus",function(t){console.info(t)}),this.$socket.on("novel",function(e){0===e.errorCode&&(t.loading=!1,"latest"===e.data.eventType&&(t.percent=100),console.info(e),t.$Notice.success({duration:0,title:e.msg||"",render:function(t){return t("div",[t("p",["下载地址：",t("a",{attrs:{href:location.origin+e.data.url,download:e.data.name+".txt"}},e.data.name)]),t("p","开始时间："+e.data.startTime||""),t("p","结束时间："+e.data.endTime||""),t("p","耗时(s)："+e.data.timeConsuming||""),t("p","总章节："+e.data.count||""),t("p","成功章节："+Number(e.data.count-e.data.failCount)),t("p","失败章节："+e.data.failCount||"")])}}),t.newNovelDownload=!0)}),this.$socket.on("novelData",function(e){console.info(e),0===e.errorCode&&(t.novelTable=e.data||[],t.pageData.totals=e.totals||1,t.pageData.page=e.pageCurrent||1),t.loading=!1,t.percent=100}),this.$socket.on("missionFail",function(e){console.info(e),e.errorCode&&(t.percent=100,t.$Notice.warning({title:"任务失败",desc:e.msg||"error"})),t.progressStatus="wrong"}),this.$socket.on("download",function(e){var o;0===e.errorCode&&(t.webSocketCountData.push(e.index),(o=t.novelData).push.apply(o,a()(e.data)))}),this.$socket.on("downloadNotify",function(e){0===e.errorCode&&(t.webSocketCount=e.count,t.$Notice.success({duration:0,title:e.msg||"",render:function(t){return t("div",[t("p","开始时间："+e.startTime||""),t("p","结束时间："+e.endTime||""),t("p","耗时(s)："+e.timeConsuming||""),t("p","总章节："+e.count||""),t("p","成功章节："+Number(e.count-e.failCount)),t("p","失败章节："+e.failCount||"")])}}))}),this.$socket.on("receive1",function(t){console.info(t)})},formatNovelData:function(t){return t.replace(/\s{10}/g,"\n\n　　").replace(/\s{8}/g,"\n\n　　")},downloadBook:function(){var t=new Blob([this.novelCustomerContent],{type:"text/plain"}),e=document.createElement("a");e.innerHTML=this.keyword+".txt",e.href=window.URL.createObjectURL(t),e.download=this.keyword+".txt",this.$nextTick(function(){document.querySelector(".download").innerHTML="",document.querySelector(".download")&&document.querySelector(".download").appendChild(e)})},downloadNotify:function(){"default"===this.selectType||this.downloadCustomer()},downloadCustomer:function(){this.customerNovel()},novelTesting:function(){this.$socket.emit("receive",{params:"客户端发给你的一段消息"}),this.$ajax.get("/api/novel/novelTesting").then(function(t){console.info(t)}).catch(function(t){console.info(t)})},setProgress:function(){var t=this;this.percent=0;var e=setInterval(function(){return t.percent<99&&t.percent++,t.percent>98&&t.percent<100?(t.percent=99,clearInterval(e),!1):100===t.percent?(clearInterval(e),!1):void console.log(t.percent)},1e3)},onClearNovel:function(){var t=this;this.$ajax.post("/api/novel/clearNovel").then(function(e){0===e.errorCode?t.$Notice.success({title:"任务成功",desc:e.msg||"success"}):(t.progressStatus="wrong",t.$Notice.warning({title:"任务失败",desc:e.msg||"error"}))}).catch(function(t){console.info(t)})},getNovel:function(){return this.keyword?"customer"!==this.selectType||this.customerUrl?(this.$Notice.close("novelNotify"),void("default"===this.selectType||this.customerNovel())):(this.$Message.error("请输入爬取目标小说目录所在的url"),!1):(this.$Message.error("尚未输入小说名"),!1)},customerNovel:function(){var t=this;this.loading=!0,this.setProgress(),this.novelData=[],this.webSocketCountData=[],this.customerStatus=!1,this.$ajax.post("/api/novel/customizedNovel",{url:this.customerUrl,keyword:this.keyword.trim()}).then(function(e){console.info(e),t.loading=!1,0===e.errorCode?(t.webSocketCount=e.count,t.percent=100,t.customerStatus=!0,t.downloadBook(),t.$Notice.success({duration:0,title:e.msg||"",render:function(t){return t("div",[t("p","开始时间："+e.startTime||""),t("p","结束时间："+e.endTime||""),t("p","耗时(s)："+e.timeConsuming||""),t("p","总章节："+e.count||""),t("p","成功章节："+Number(e.count-e.failCount)),t("p","失败章节："+e.failCount||"")])}})):(t.customerStatus=!1,t.percent=100,t.$Notice.warning({title:e.msg||"",desc:e.data||[]}))}).catch(function(e){t.customerStatus=!1,t.$Notice.error({title:"无法处理你的请求",desc:e.msg}),t.pageData.totals=1,t.pageData.page=1})}}}},TAS0:function(t,e,o){var n=o("meAJ");"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);o("rjj0")("15c215a0",n,!1,{sourceMap:!1})},"TI/+":function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=o("PMX5"),a=o("cCmq"),r=!1;var s=function(t){r||o("TAS0")},i=o("VU/8")(n.a,a.a,!1,s,"data-v-2ed6a393",null);i.options.__file="pages/novel.vue",e.default=i.exports},"c/Tr":function(t,e,o){t.exports={default:o("5zde"),__esModule:!0}},cCmq:function(t,e,o){"use strict";var n=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("section",{staticClass:"container"},[o("div",{staticClass:"novel"},[o("div",{staticClass:"input-body"},[o("Progress",{attrs:{percent:t.percent,status:t.progressStatus}}),o("i-input",{attrs:{size:"large",icon:"search",placeholder:"查找的小说"},model:{value:t.keyword,callback:function(e){t.keyword=e},expression:"keyword"}},[o("Select",{staticStyle:{width:"70px"},attrs:{slot:"append",disabled:""},slot:"append",model:{value:t.selectType,callback:function(e){t.selectType=e},expression:"selectType"}},[o("Option",{attrs:{value:"customer"}},[t._v("自定义")])],1)],1),"customer"===t.selectType?o("Input",{staticStyle:{"margin-top":"20px"},attrs:{size:"large",icon:"network",placeholder:"请输入小说的目录URL，如：https://www.biduo.cc/biquge/44_44762/"},model:{value:t.customerUrl,callback:function(e){t.customerUrl=e},expression:"customerUrl"}}):t._e()],1),o("Button",{staticStyle:{"margin-top":"20px"},attrs:{loading:t.loading,type:"primary",long:""},on:{click:t.getNovel}},[t._v("执行任务")]),o("Button",{directives:[{name:"show",rawName:"v-show",value:t.isDoneWebSocketCustomer||t.customerStatus,expression:"isDoneWebSocketCustomer||customerStatus"}],staticStyle:{"margin-top":"10px"},attrs:{type:"ghost",long:""}},[o("Icon",{attrs:{type:"ios-cloud-download"}}),o("span",{staticClass:"download",staticStyle:{"margin-left":"5px"}})],1),o("div",{staticClass:"btn-group"},[o("ButtonGroup",{staticStyle:{"margin-top":"20px"}},[o("Button",{attrs:{type:"ghost"},on:{click:t.onClearNovel}},[o("Icon",{attrs:{type:"trash-a"}}),t._v("\n              手动清空任务栈")],1),t.isDev?o("Button",{attrs:{type:"ghost"},on:{click:t.novelTesting}},[o("Icon",{attrs:{type:"information-circled"}}),t._v("\n              临时测试")],1):t._e()],1)],1),o("Card",{attrs:{bordered:!1,"dis-hover":!0}},[o("p",[t._v("- 需要输入小说名和网站目录地址成功后，会生成txt文件")]),o("p",[t._v("- 目录过长可能会丢失部分章节")]),o("p",[t._v("- iPhone/iPad等无法下载，请更换PC/Android")]),o("p",[t._v("- 如有问题，请联系"),o("a",{attrs:{href:"https://weibo.com/Naruzi",target:"_blank"}},[t._v("@叶箫大人")])])])],1)])};n._withStripped=!0;var a={render:n,staticRenderFns:[]};e.a=a},fBQ2:function(t,e,o){"use strict";var n=o("evD5"),a=o("X8DO");t.exports=function(t,e,o){e in t?n.f(t,e,a(0,o)):t[e]=o}},meAJ:function(t,e,o){(t.exports=o("FZ+f")(!1)).push([t.i,".novel .input-body[data-v-2ed6a393]{height:100%;margin-top:25%}.novel[data-v-2ed6a393]{width:650px;margin:0 auto 100px}.btn-group[data-v-2ed6a393]{text-align:center}@media screen and (max-width:767px){.novel[data-v-2ed6a393]{width:80%;min-width:320px;margin:0 auto}}",""])},qyJz:function(t,e,o){"use strict";var n=o("+ZMJ"),a=o("kM2E"),r=o("sB3e"),s=o("msXi"),i=o("Mhyx"),c=o("QRG4"),l=o("fBQ2"),u=o("3fs2");a(a.S+a.F*!o("dY0y")(function(t){Array.from(t)}),"Array",{from:function(t){var e,o,a,d,p=r(t),v="function"==typeof this?this:Array,f=arguments.length,m=f>1?arguments[1]:void 0,h=void 0!==m,g=0,w=u(p);if(h&&(m=n(m,f>2?arguments[2]:void 0,2)),void 0==w||v==Array&&i(w))for(o=new v(e=c(p.length));e>g;g++)l(o,g,h?m(p[g],g):p[g]);else for(d=w.call(p),o=new v;!(a=d.next()).done;g++)l(o,g,h?s(d,m,[a.value,g],!0):a.value);return o.length=g,o}})}});